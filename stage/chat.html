<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="emTesseract Ops ‚Äî Chat with agents">
  <title>Chat ‚Äî emTesseract Ops</title>
  <link rel="icon" type="image/png" href="/logo.png?v=2" sizes="any">
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/stage/stage.css">
  <script>
    (function () {
      var t = localStorage.getItem("emtesseract-theme") || (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
      document.documentElement.setAttribute("data-theme", t);
    })();
  </script>
</head>

<body class="stage-page stage-page--chat">
  <header class="stage-header">
    <div class="stage-header__inner">
      <a href="/" class="stage-logo">
        <img src="/logo.png" alt="emTesseract" width="32" height="32">
        <span>Chat</span>
      </a>
      <nav class="stage-nav">
        <a href="/stage/">Stage</a>
        <a href="/stage/swimlane.html">Swimlane</a>
        <a href="/">‚Üê Home</a>
        <button type="button" class="theme-toggle" aria-label="Toggle light/dark mode">
          <span class="theme-toggle__icon">üåô</span>
          <span class="theme-toggle__label">Dark</span>
        </button>
      </nav>
    </div>
  </header>

  <main class="chat-main">
    <aside class="chat-sidebar">
      <section class="chat-agents">
        <h2 class="stage-section__title">Chat with</h2>
        <div class="chat-agents-list" id="chat-agents-list">
          <!-- Populated by JS -->
        </div>
      </section>
    </aside>

    <section class="chat-panel">
      <div class="chat-messages" id="chat-messages" role="log" aria-live="polite">
        <div class="chat-welcome" id="chat-welcome">
          <p>Pick an agent to start. They‚Äôll respond using the same model as roundtables.</p>
        </div>
      </div>
      <form class="chat-input-form" id="chat-input-form">
        <textarea
          id="chat-input"
          placeholder="Type a message‚Ä¶"
          rows="1"
          autocomplete="off"
          aria-label="Message"
        ></textarea>
        <button type="submit" class="chat-send" id="chat-send" aria-label="Send" disabled>
          <span class="chat-send__icon">‚Üí</span>
        </button>
      </form>
    </section>
  </main>

  <script src="/stage/config.js"></script>
  <script src="/stage/shared.js"></script>
  <script src="/stage/chat.js"></script>
  <script>
    (function () {
      const storageKey = "emtesseract-theme";
      const getPreferred = () =>
        localStorage.getItem(storageKey) ||
        (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
      const setTheme = (theme) => {
        document.documentElement.setAttribute("data-theme", theme);
        const btn = document.querySelector(".theme-toggle");
        if (btn) {
          btn.querySelector(".theme-toggle__icon").textContent = theme === "dark" ? "‚òÄÔ∏è" : "üåô";
          btn.querySelector(".theme-toggle__label").textContent = theme === "dark" ? "Light" : "Dark";
        }
        localStorage.setItem(storageKey, theme);
      };
      setTheme(getPreferred());
      document.querySelector(".theme-toggle")?.addEventListener("click", () => {
        setTheme(document.documentElement.getAttribute("data-theme") === "dark" ? "light" : "dark");
      });
    })();
  </script>
</body>

</html>
